:root{
  --bg:#0b0f1a;
  --text:#e7ecff;
  --muted:#a8b0c6;
  --tube:rgba(255,255,255,.18);
  --accent:#7cf6e6;
  --frame:#ffffff22;
  --glow:0 0 10px rgba(124,246,230,.25);
  --green:#29d17a;
  --red:#ff5c5c;
  --badge:#dbe5ff;
  --badge-lock:#9aa6c7;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--text);
  font-family:system-ui,Segoe UI,Arial,sans-serif;
}

.wrap{
  min-height:100dvh;
  display:grid;
  place-items:center;
  gap:18px;
  padding:24px;
}

.tube-host{
  width:min(92vmin, 900px);
  aspect-ratio:1/1;
  position:relative;
  overflow:visible;
  background:none;
}

.tube-svg{width:100%; height:100%; display:block}
.tube-glow{ filter: drop-shadow(0 0 14px rgba(124,246,230,.18)); }

.panel{
  width:min(92vmin, 900px);
  border-radius:14px;
  padding:12px 14px;
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.025));
  display:grid;
  grid-template-columns: 1fr 1fr 1fr;
  gap:10px 14px;
}
.control{
  display:grid;
  grid-template-columns: 1fr auto;
  gap:10px;
  align-items:center;
}
.control.toggle{
  grid-template-columns: auto 1fr;
  justify-content:flex-start;
  gap:10px;
}
.control label{color:var(--muted); font-size:.95rem}
.control input[type="range"]{
  grid-column: 1 / 3;
  accent-color: var(--accent);
  width:100%;
}
.val{color:var(--muted); font-variant-numeric:tabular-nums}

/* أزرار صغيرة في اللوحة */
.small-btns{ display:flex; justify-content:center; gap:8px; }
.small-btns button{
  padding:6px 10px; font-size:0.8rem; border-radius:8px;
  border:1px solid #ffffff22; background: rgba(255,255,255,.05);
  color: var(--text); cursor:pointer; transform: scale(0.95);
}
.small-btns button:hover{ border-color:#ffffff44; box-shadow:0 0 0 3px #7cf6e61f; }

/* التريل */
.trail-blur{ filter: blur(2px); opacity:.85; }

/* ===== مربع الأسئلة داخل المثلث ===== */
.question-box{
  position:absolute; inset:0; display:grid; pointer-events:none; z-index:1;
  align-items:end; justify-items:center; padding-bottom: calc(6% + 30px);
}
.question-inner{
  width: 42%; aspect-ratio: 1/1; border-radius: 14px;
  background: rgba(0,0,0,0.18); border: 1px solid #ffffff22;
  box-shadow: 0 6px 30px rgba(0,0,0,.35), 0 0 20px rgba(124,246,230,.15);
  overflow: hidden; display:grid; place-items:center;
}
.question-img{
  max-width: 115%; max-height: 115%; width: 115%; height: 115%;
  object-fit: cover; opacity: 0; transform: scale(1.12);
  transition: opacity 240ms ease, transform 300ms ease;
}
.question-img.show{ opacity: 1; transform: scale(1.12); }

/* ===== لاعبو الزوايا ===== */
.players-overlay{
  position:absolute; inset:0; pointer-events:auto; z-index:2;
}
.player-slot{
  position:absolute; display:flex; flex-direction:column; align-items:center;
  gap:6px; transform: translate(-50%, -50%);
  --avatar-diam: 180px; /* يُمرر من JS */
}
.player-slot .avatar{
  width:100%; aspect-ratio:1/1; border-radius:50%; object-fit:cover;
  border:2px solid var(--frame); box-shadow: var(--glow); pointer-events:none;
  background:
    radial-gradient(30% 30% at 30% 30%, rgba(255,255,255,.12), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.06));
}
.player-slot .pname{
  font-weight:600; font-size:.95rem; color:var(--text);
  text-shadow: 0 0 6px rgba(0,0,0,.35); pointer-events:none;
}

/* ===== نقاط اللاعبين (الأسهم + العداد) ===== */
.score-controls{
  position:absolute; top:50%; transform: translateY(-50%);
  display:flex; align-items:center; gap:6px; z-index:3;
}
.score-right{ right:-110px; } /* يمين الصورة */
.score-left { left:-110px; }  /* يسار الصورة */

.score-btn{
  width:26px; height:26px; display:grid; place-items:center;
  border-radius:6px; border:1px solid #ffffff22; background: rgba(255,255,255,.07);
  color: var(--text); cursor:pointer; user-select:none; line-height:1; font-size:14px;
}
.score-btn.up   { color: var(--green); }
.score-btn.down { color: var(--red);   }
.score-btn:hover{ box-shadow:0 0 0 3px #7cf6e61a; border-color:#ffffff44; }

.score-value{
  min-width: 34px; padding:4px 6px; border-radius:6px; border:1px solid #ffffff22;
  background: rgba(255,255,255,.05); color: var(--text); text-align:center;
  font-variant-numeric: tabular-nums; font-weight:600;
}

/* ===== صف مربعات "الخواص" بجانب الصورة ===== */
.perks-row{
  position:absolute;
  top: calc(50% + 50px);   /* نازل 50px حسب طلبك الأخير */
  transform: translateY(-50%);
  display:flex;
  align-items:center;
  gap:8px;
  z-index:3;
}
/* ملاصقة لحافة الصورة بمسافة ~18px */
.perks-right{
  left: calc(100% + 18px);   /* يمين الصورة */
  right: auto;
}
.perks-left{
  right: calc(100% + 18px);  /* يسار الصورة */
  left: auto;
}

/* حجم المربعات */
.perk{
  width: calc(var(--avatar-diam) * 0.34);
  height: calc(var(--avatar-diam) * 0.34);
  max-width: 88px; max-height: 88px;
  min-width: 54px; min-height: 54px;
  border-radius: 12px;
  border: 1px solid #ffffff22;
  background: rgba(255,255,255,.06);
  box-shadow: 0 2px 10px rgba(0,0,0,.25);
  overflow: hidden;
  display:grid; place-items:center;
  transition: box-shadow 200ms ease, border-color 200ms ease, transform 140ms ease;
  cursor: pointer;
}
.perk:hover{ border-color:#ffffff44; transform: translateY(-1px); }
.perk.on{
  box-shadow: 0 0 20px rgba(124,246,230,.25), 0 0 8px rgba(124,246,230,.22);
  border-color: #7cf6e640;
}
.perk-img{
  width:100%; height:100%; object-fit: contain; background: transparent;
}

/* ===== نوافذ العروض (المربع 2 و 3) ===== */
.modal-dim{
  position: fixed; inset: 0;
  background: rgba(0,0,0,.65);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}
.modal-dim.show{ display:flex; }

.modal-center{
  max-width: 80vw; max-height: 80vh;
  display: grid; place-items: center;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 8px 40px rgba(0,0,0,.45);
  background: transparent;
}
.modal-center img, .modal-center video{
  max-width: 100%; max-height: 100%;
  display:block; object-fit: contain; background: #0000;
}

/* تغطية كاملة (المربع 3 - نيوك) */
.modal-full{
  position: fixed; inset: 0; z-index: 10000; display:none;
  background: #000;
}
.modal-full.show{ display:block; }
.modal-full video{
  width:100%; height:100%; object-fit: cover; display:block;
}
.winner-banner{
  position: absolute; bottom: 6%; left: 50%; transform: translateX(-50%);
  padding: 10px 16px; border-radius: 12px;
  background: rgba(0,0,0,.55); color: #fff; font-weight: 700; font-size: 1.2rem;
  border: 1px solid #ffffff33; box-shadow: 0 0 18px rgba(124,246,230,.25);
}

/* ===== أزرار البدء/الإيقاف مثبتة يمين منتصف الشاشة ===== */
.side-controls{
  position: fixed; right: 16px; top: 50%; transform: translateY(-50%);
  display: flex; flex-direction: column; gap: 10px; z-index: 10;
}
.side-btn{
  padding:8px 12px; font-size:0.9rem; border-radius:10px;
  border:1px solid #ffffff22; background: rgba(255,255,255,.08);
  color: var(--text); cursor:pointer; box-shadow: 0 4px 16px rgba(0,0,0,.25);
}
.side-btn:hover{ border-color:#ffffff44; box-shadow:0 0 0 3px #7cf6e61f, 0 6px 20px rgba(0,0,0,.28); }
